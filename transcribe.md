
Blackmagic Design Meetup｜E7
https://bmd.connpass.com/event/207158/
https://www.slideshare.net/kitazaki/20210315-bmdjp-kitazaki-v1

台本

それではLT発表させていただきます。
ノラハックチームのざっきーと申します。
IoTLTというIoTやモノづくり中心のコミュニティで放送部活動をしています。

本日の話はM5Core2 ATEMスイッチャーを先日発売されたATEM Mini Extreme対応させたという内容になります。

M5Core2というデバイスをご存知ない方のために簡単に説明すると、M5Stack社が販売している1辺5cm角のIoTデバイスです。
ESP32というWi-Fi、Bluetooth機能を持ったマイコンチップが搭載されていて、表はタッチセンサー付きのディスプレイになっています。

それではまず、IoTLT放送部の成り立ちから紹介します。

私がコミュニティ活動を始めたのは2017年1月からです。
IoTLTのイベントを本社で開催するので、その盛り上げ役（いわゆる、賑やかし担当）として関わることになりました。
当時、Amazonダッシュボタンをハックするネタが流行っていたので、Amazonダッシュボタンを使用してPepperを動かすという
デモ展示を行いました。

IoTLTコミュニティは毎月開催されていますので、その後、継続的にIoTLTのイベントへ顔を出すようになり、2018年8月の
コミュニティイベントの懇親会で「素晴らしいコンテンツが1回限りのLTだけではもったいないよね！」という話になり、
動画を撮ってYouTubeチャンネルへ保存し公開するようになりました。

おかげさまで、チャンネル登録者数は昨年12月に1,000人を超えて、配信数とアーカイブ数を合わせると140本近くになりました。
昔はチャンネル登録者数が1,000人いなくてもモバイル配信ができていたので、ライブ配信の敷居が低かったです。
途中で1,000人、年間再生時間が4,000時間を超えることがモバイル配信の条件に変更されて、PCから配信していたのですが、
条件をクリアしてモバイル配信が復活したので良かったです。
おそらく、この方針変更がなければ、そのままモバイル配信をし続けていたと思いますので、ATEM Miniに出会うことはなかったと思います。

時系列で表すと次のスライドのとおりです。
このグラフはconnpassのAPIを利用して日次でイベント情報を取得して都道府県毎、オンラインイベント数を表示したものです。
最近はコロナ禍でオンラインイベントが主流ですが、活動当初はオンラインイベントは稀で、オフラインイベントが主流でした。
イベント会場でWi-Fi接続ができた場合はベストエフォートでライブ配信を行っていました。

次のスライドはイベント会場で配信環境に適しているか、そうでないかを分類したもので、大きく3パターンに分かれます。
パターン1は一番配信に適した環境で、ほとんどのケースはパターン2でした。これはセキュリティの考慮からWi-Fi接続クライアント同士の
通信を禁止しています。パターン3が厄介で、配信で使用する通信ポート番号が閉じられてケースで、注意が必要です。

前のスライドに戻り、先ほど申し上げたとおり、モバイル配信ができなくなって、PCから配信を行っていましたので、
2019年12月にATEM Miniが初めて発売された時に「これは！」と思い、直ぐに手を出しました。
その後、ATEM Mini Pro、Pro ISOと手を出し、Extremeに至ります。(残念ながらExtreme ISOはまだです。笑）

次々のスライド
最初は家庭向けのビデオカメラとゲーム配信用のキャプチャーボードを使用してPCのOBS Studioから配信を行っていました。
簡単にスマホからモバイル配信を行うこともありました。

次のスライド
機材を持ち歩くのが大変なときは、Live Event CameraのMevoから配信を行うこともありました。これはPCからの配信と同じで、
スマホからストリームキーを設定すればモバイル配信と同様に簡単に配信できます。

次のスライド
遂にATEM Miniの登場です。実は年末に入手したので、最初に使ったのはオンライン配信でした。技術界隈では12月にクリスマスに向けて
アドベントカレンダーとして毎日記事を書く習慣があり、その記事の内容を紹介するイベントで使用しました。
年末年始、予定がある方や休暇で地元に帰省している人も多かったので、Zoomなどのコミュニケーションツールと使い、
オフラインとオンラインのミックスで配信を行ったので、いきなりハードルが高い経験をすることになりました。

次のスライド
その後はコロナ禍で緊急事態宣言が発出されて、2020年3月以降は基本的にオンラインイベントに変わっていくことになりますが、
それまではオフラインファーストの考え方が強く、しばらくはオフラインとオンラインの併用イベントが続きました。
配信をやったことがある方はご存知だと思いますが、併用イベントだと音声の取り扱いが難しいので、画面切り替えなどの配信の手間を
極力減らして、楽にしたいという思いがありました。

次のスライド
そして遂にATEM Mini Proの登場です。全入力とプレビューとプログラムを一度に確認できるマルチビュー機能が追加され、
ATEM Mini Proから直接配信できるということで、これも直ぐに手を出しました。
時期的にオンライン配信が基本になったことと、ATEM Mini Proへ切り替えたことで、配信に余裕が生まれました。
配信しながらLT登壇もすることもできるようになりました。

次のスライド
そうして、とうとう本日のメインの話の、Blackmagic Design社は実は「ソフトウェア企業」説という話につながっていきます。
私が最初に「ソフトウェア企業」説に気がついたきっかけは、ATEM Mini ProをPCへ接続する際にUSBの他にイーサネットも
接続していたときでした。
イベント会場で有線LANが提供されることはほぼ無く、提供されたとしてもWi-Fi環境だったため、ATEM Mini Proから直接配信する場合は
PCのネットワーク共有機能を経由して配信することになります。
ATEM MiniやProをウェブカメラとして使用する場合、USB接続が必要になるので、ATEM Software Controlから操作する場合も
基本的にUSB接続で使用していました。
たまたま、USB接続を忘れてイーサネット接続しかしていない時にATEM Software Controlを使用できることに気がついた時に
「ソフトウェア企業」説が頭に芽生えました。

次のスライド
ここからはATEM Mini Proをイーサネット経由で操作する話になります。
Node-REDというJavascript言語で書かれたビジュアルプログラミングソフトウェアを使用してATEM Mini Proの操作を
試してみた記事になります。

次のスライド
最初はネットワーク経由で操作できる仕組みを調べるために、Wiresharkというネットワークキャプチャーソフトウェアを使用して
解析してみました。標準ではATEM Mini Proの通信内容を解析できないため、プラグインをインストールする必要があります。
このプラグインはLuaという言語で書かれたスクリプトです。
ATEM Software Controlを起動してWiresharkの画面を見ると、BMDプロトコルはUDPで通信を行い、定期的に(具体的には1秒間隔で)
通信が行われていることが確認できます。

次のスライド
次にソフトウェアを自分で書こうとして調べ始めたところ、実はATEMスイッチャーソフトやアップデートの中にSDKが含まれていることに
気がつきました。ホームページのサポートリンクからSDK単体をダウンロードすることもできます。
真ん中の画像ですが、SDKのドキュメントやサンプルのソースコードを確認することができます。

次のスライド
SDKのドキュメントを参照すると、600ページ以上あり、全てのAPIの仕様を確認することができます。
履歴を追うと2012年からAPIが実装されていることがわかり、Blackmagic Design社が「ソフトウェア企業」であることが
証明されたと思います。

次のスライド
実際にNode-REDでノードと呼ばれるモジュール、ここでは、Blackmagic-atem-noderedというノードを追加して、
入力画面の切り替え操作を試してみました。
Node-REDとATEM Software Controlソフトウェアは排他制御ではなく、同時に使用することが可能です。
実際に使用してみるとわかりますが、一方で入力切り替えを行うと、もう一方でも情報が更新され、入力が切り替わります。
パケットキャプチャーを確認すると、入力切り替えと同時に、すべての接続デバイスへ情報の更新通知が送信されていました。

次のスライド
メディアアート界隈でよく利用される、TouchDesignerというオーディオビジュアルソフトウェアからATEM Mini Proを操作してみました。
こちらもオペレータと呼ばれるカスタムオペレータを追加する必要がありますが、Node-REDと同様に入力の切り替えを行うことができます。
もし興味があればQRコードから詳細をご確認ください。

次のスライド
最後にM5Core2 ATEMスイッチャーの話をします。
M5Core2というIoTデバイスを使用してWi-Fi経由でATEM Mini Proを操作することができます。

次のスライド
画面とボタンの配置は次のスライドのとおりです。入力キーと、いわゆるタリーライトを表示し、タッチボタンで入力を切り替えられます。
M5Core2はバッテリーも搭載しているため、ケーブルを接続せず、このデバイス単体で操作することができます。

次のスライド
もし興味があればQRコードから詳細をご確認ください。ソースコードも載せています。
ライブラリを追加する必要がありますが、Arduino IDE互換でビルド・インストールすることができます。
4個と8個で入力数に違いがありますので、表示・タッチセンサーの理由で、ATEM Mini ProとExtremeとでソースコードを分けていますが、
実はどちらのソースコードでもProとExtremeの両方で使用できることができます。
APIの完成度の高さが分かり、その辺からもBlackmagic Design社が「ソフトウェア企業」であることを伺い知ることができると思います。

以上です。ご清聴ありがとうございました。


